<html>
<head>
  <title>2.1 Async 异步流程控制</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303788 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win32);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="947"/>
<h1>2.1 Async 异步流程控制</h1>

<div>
<span><div>解决 ： 回调地狱</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-size: 12px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">var async = require(&quot;async&quot;);  </span><span style="font-size: 12px; background-color: rgb(255, 250, 165); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;-evernote-highlight:true;">//非标准的 第三方模块  社区推荐  要安装（npm init ==&gt; npm  install async --save-dev ）</span></div><div style="background-color: rgb(251, 250, 248);"><br/></div><div style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">function test1(callback){</span></div><div style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">     setTimeout(()=&gt;{</span></div><div style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">          console.log(&quot;test1&quot;);</span></div><div style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">          callback(null,&quot;11111&quot;);</span></div><div style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">     },1000)</span></div><div style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}</span></div><div style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">function test1(callback){</span></div><div style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">     setTimeout(()=&gt;{</span></div><div style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">          console.log(&quot;test2&quot;);</span></div><div style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">          callback(null,&quot;22222&quot;);</span></div><div style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">     },1000)</span></div><div style="background-color: rgb(251, 250, 248);"><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}</span></div><div style="background-color: rgb(251, 250, 248);"><br/></div><div style="background-color: rgb(251, 250, 248);"><br/></div></div><div><br/></div><div><span style="font-weight: bold;">//</span><span style="box-sizing: border-box; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><span style="font-weight: bold; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 11pt;">.series </span></span><span style="font-weight: bold;">串行无关联      （先调用 ==》再调用 ==》再</span><span style="font-weight: bold;">调用</span><span style="font-weight: bold;">） 实际意义不大   不能传参数</span></div><div><img src="2.1 Async 异步流程控制_files/Image.png" type="image/png" style="font-weight: bold;"/></div><div style="box-sizing: border-box; padding: 8px; font-size: 12px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">async.series([test1,test2]),function(error,res){</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">     if(error){</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">          console.log(error);</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">     }else{</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">          console.log(res);</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">     }</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">     </span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}</span></div></div><div><img src="2.1 Async 异步流程控制_files/Image [1].png" type="image/png"/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">//</span><span style="box-sizing: border-box; font-size: 11pt; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); font-weight: bold; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">.parallel </span><span style="font-weight: bold;">并行无关联</span>  </div><div>callback第一个参数为null ，则相当于promise的resolve状态<span style="line-height: 1.45;">    </span><span style="line-height: 1.45;">                                     </span></div><div><span style="line-height: 1.45;">            第一个参数为有价值的错误信息 ， 则相当于promise的reject状态</span></div><div style="font-size: 14px;"><div><span style="font-size: 14px;"><img src="2.1 Async 异步流程控制_files/Image [2].png" type="image/png" style="font-size: 11pt;"/></span></div></div><div style="box-sizing: border-box; padding: 8px; font-size: 12px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">async.parallel([test1,test2]),function(error,res){</span></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">     if(error){</span></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">          console.log('error---',error);</span></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">     }else{</span></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">          console.log('正常调用---',res);</span></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">     }</span></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">     </span></div><div><span style="font-size: 11pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">}</span></div></div><div style="font-size: 14px;"><div><span style="font-size: 14px;"><img src="2.1 Async 异步流程控制_files/Image [3].png" type="image/png" style="font-size: 11pt;"/></span></div></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">//.</span><span style="box-sizing: border-box; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><span style="font-weight: bold; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12pt;">waterfall </span></span><span style="font-weight: bold;">串行有关联     （相当于promise的.then() .then() .then() 链式调用，1返回结果给2==&gt;2返回结果给3==&gt;最后把请求结果给result）</span></div><div><img src="2.1 Async 异步流程控制_files/Image [4].png" type="image/png" style="font-weight: bold;"/></div><div style="box-sizing: border-box; padding: 8px; font-size: 12px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">async.waterfall([test1,test2,test3],function(error,result){</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">     console.log(result);</span></div><div><span style="background-color: rgb(251, 250, 248); font-size: 12px; color: rgb(51, 51, 51); font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;">})</span></div></div><div><img src="2.1 Async 异步流程控制_files/Image [5].png" type="image/png"/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 