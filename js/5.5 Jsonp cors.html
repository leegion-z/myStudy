<html>
<head>
  <title>5.5 Jsonp cors</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303788 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win32);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="415"/>
<h1>5.5 Jsonp cors</h1>

<div>
<span><div><span style="font-weight: bold;">同源策略</span></div><div><br/></div><div>    同源策略（Same origin policy）是一种约定，它是<span style="font-weight: bold;">浏览器</span>最核心也最基本<span style="font-weight: bold;">的安全功能</span>，如果缺少了同源策略，则浏览器的正常功能可能都会受到影响。          </div><div><br/></div><div>    所谓同源指的是“三个相同”：                </div><div>        <span style="font-weight: bold;">1. 协议相同                </span></div><div><span style="font-weight: bold;">        2. 域名相同                </span></div><div><span style="font-weight: bold;">        3. 端口相同</span></div><div><br/></div><div><hr/><div><br/></div></div><div><span style="font-weight: bold;">跨域常见方案</span></div><div><br/></div><div>    跨域，指的是<span style="font-weight: bold;">浏览</span>器<span style="font-weight: bold;">不能执行其他网站的脚本</span>。它是由浏览器的同源策略造成的，是浏览器对javascript施加的安全限制。</div><div><br/></div><div>    <span style="font-weight: bold;">常见的跨域解决方案：                </span></div><div><span style="font-weight: bold;">        1. jsonp                </span></div><div><span style="font-weight: bold;">        2. cors      (跨域资源共享)          </span></div><div><span style="font-weight: bold;">        3. 反向代理 </span></div><div><br/></div><div><hr/><div><br/></div></div><div><span style="font-weight: bold;">JSONP  : json + padding(内填充)</span></div><div><br/></div><div>    JSONP方式的跨域操作，是<span style="font-weight: bold;">利用了script标签不受同源策略的影响</span>，可以利用script标签引入任意域下的文件，从而实现数据的请求。<b>动态创建script标签</b></div><div>    script标签的<span style="font-weight: bold;">src</span>不仅可以引入JS文件，也<span style="font-weight: bold;">可以引入任何类型</span>的文件 。 </div><div>    script标签的数据，只能通过<span style="font-weight: bold;">get</span>方式进行提交。            </div><div>    </div><div>    JSONP是服务器与客户端跨源通信的常用方法。最大特点就是简单适用，老式浏览器全部支持，服务器改造非常小。               </div><div><br/></div><div>    JSONP的缺点是<span style="font-weight: bold;">只能实现GET请求</span>，不能实现POST请求，<span style="font-weight: bold;">传递</span>的<span style="font-weight: bold;">数据</span>需要<span style="font-weight: bold;">暴露在URL上</span>。</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-size: 12px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">function getJSON(url,cbFn){</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">        var script = document.createElement('script');</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">        var re = /cb=(\w+)/;</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">        url = url.replace( re , function(arg){</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">            return arg + String(Math.random()).replace(/\./,'');</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">        });</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">        var fnName = url.match(re)[1];</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">        window[fnName] = cbFn;</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">        script.src = url;</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">        script.onload = function(){</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">            document.body.removeChild(script);</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">            delete window[fnName];</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">        };</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">        document.body.appendChild(script);</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">    }</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">    getJSON('</span><a href="http://www.b.com/H51707_2018_2/dataJSONP.php?cb=foo&amp;id=3',function(data" style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">http://www.b.com/H51707_2018_2/dataJSONP.php?cb=foo&amp;id=3',function(data</a><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">){</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">        console.log(data);</span></div><div><span style="font-size: 9pt; background-color: rgb(251, 250, 248); color: rgb(51, 51, 51); font-family: Monaco;">    });</span></div></div><div><br/></div><div><br/></div><div>jq:</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>function xxxcallback(result){   //前端和后端的xxx函数名必须一样</div><div><span>    console.log(result)</span><br/></div><div>}</div><div><br/></div><div>var oscript = document.createElement(&quot;script&quot;);</div><div><br/></div><div>oscript.src=&quot;http://xxxxx.com/xxx&quot;;</div><div><br/></div><div>document.body.appendChild(oscript);</div></div><div><br/></div><div><br/></div><div>后端要返回 函数格式的数据</div><div><img src="5.5 Jsonp cors_files/Image.png" type="image/png"/></div><div><br/></div><div>前端定义一下这个函数：</div><div><img src="5.5 Jsonp cors_files/Image [1].png" type="image/png"/></div><div><br/></div><div><br/></div><div>jq和nodejs 的完美结局方法：</div><div>后端：</div><div><img src="5.5 Jsonp cors_files/Image [2].png" type="image/png"/></div><div><br/></div><div>前端：</div><div><img src="5.5 Jsonp cors_files/Image [3].png" type="image/png"/></div><div><br/></div><div><br/></div><div><br/></div><div><hr/><div><br/></div></div><div><br/></div><div><span style="font-weight: bold;">CORS</span></div><div><br/></div><div>    CORS是一个W3C标准，全称是&quot;跨域资源共享&quot;（Cross-origin resource sharing）。它允许浏览器向跨源服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。          </div><div>    </div><div>    实现CORS跨域操作，只需要由服务器发送一个响应标头即可。          </div><div><br/></div><div>    header('Access-Control-Allow-Origin : <a href="http://www.a.com'/">http://www.a.com'</a>;);     </div><div><br/></div><div><hr/><div><br/></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 