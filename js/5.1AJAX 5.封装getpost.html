<html>
<head>
  <title>5.1AJAX 5.封装get/post</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303788 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win32);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="577"/>
<h1>5.1AJAX 5.封装get/post</h1>

<div>
<span><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>//回调函数 : <b>解决异步</b>执行的问题，并且在封装函数外部进行使用，不影响封装函数的通用性。</div><div><br/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">function foo(<b>fn</b>){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    setTimeout(function(){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        console.log(1);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">       <b> fn();</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    },1000);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">foo(<b>function(){</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>    console.log(4);</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">});</span></div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">===============</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">get</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">==================</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">function getAjax(url,data,fn){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    var param = data ? '?'+data : data;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    var xhr = new XMLHttpRequest();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    xhr.onreadystatechange = function(){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        if(xhr.readyState==4 &amp;&amp; xhr.status==200){</span></div><div><span style="font-family: Monaco; font-size: 9pt;">            fn(<b><font style="color: rgb(123, 0, 61);">xhr.responseText</font></b>);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    };</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    xhr.open('GET',url + param,true);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    xhr.send(null);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt;">getAjax('data.php','username=hello',function(<b><font style="color: rgb(123, 0, 61);">data</font></b>){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    </span><span style="font-family: Monaco; font-size: 9pt; line-height: 1.45;"> </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">});</span></div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">===============</span><span style="font-weight: bold; font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">post</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">==================.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">function postAjax(url,data,fn){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    var param = data ? data : null;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    var xhr = new XMLHttpRequest();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    xhr.onreadystatechange = function(){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        if(xhr.readyState==4 &amp;&amp; xhr.status==200){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            fn(xhr.responseText);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    };</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    xhr.open('POST',url,true);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    xhr.send(param);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">postAjax('data.php','username=hello',function(data){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    </span></div><div><span style="font-size: 9pt; line-height: 1.45; font-family: Monaco;">}); </span></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 