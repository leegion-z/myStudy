<html>
<head>
  <title>5.3PHP 2.PHP返回JSON数据</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303788 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win32);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="566"/>
<h1>5.3PHP 2.PHP返回JSON数据</h1>

<div>
<span><div> <br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">mysqli_fetch_row    </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span>    <span>    </span></span>返回数值数组格式</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          <img src="5.3PHP 2.PHP返回JSON数据_files/Image.png" type="image/png" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">mysqli_fetch_assoc    </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span>    <span>    </span></span>返回关联数组格式   </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      <img src="5.3PHP 2.PHP返回JSON数据_files/Image [1].png" type="image/png" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">mysqli_fetch_array    </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span>    <span>    </span></span>返回数值数组和关联数组格式 </span></div><div>    <img src="5.3PHP 2.PHP返回JSON数据_files/Image [2].png" type="image/png" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><br/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">         </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">mysqli_fetch_object     </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span>    <span>    </span></span>返回对象格式        </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     <img src="5.3PHP 2.PHP返回JSON数据_files/Image [3].png" type="image/png" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">             </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">数据转换成JSON格式    </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span>    <span>    </span></span>json_encode();        </span></div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>=================后台发送===============xxx.php</div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>&lt;?PHP</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>    header('Content-Type:text/html; charset=utf-8');     </b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>    $con = mysqli_connect('localhost','root','','h51706');</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>    mysqli_query($con,'set names utf8');</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>    $sql = &quot;select * from reg&quot;;</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>    $query = mysqli_query($con,$sql);</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">//调用的时候，只会返回一组数据</span></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    //print_r(mysqli_fetch_object($query));</span></div><div><br/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    //$row = mysqli_fetch_assoc($query);<br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    //echo $row['username'];</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    //$row = mysqli_fetch_object($query);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    //echo $row-&gt;username;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span>    //循环</span><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   <b> while($row = mysqli_fetch_assoc($query)){</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>        $arr[] = $row;    </b>//数组添加</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>    }</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    //print_r($arr);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    //print_r( json_encode($arr) );</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    <b>echo json_encode($arr);    </b>//转换json</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>?&gt;</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b><br/></b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b><br/></b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b><br/></b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">==============前端接收============xxx.html</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">function getAjax(url,data,fn){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    var param = data ? '?'+data : data;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    var xhr = new XMLHttpRequest();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    xhr.onreadystatechange = function(){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        if(xhr.readyState==4 &amp;&amp; xhr.status==200){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            fn(xhr.responseText);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    };</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    xhr.open('GET',url + param,true);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    xhr.send(null);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">getAjax('json.php',' ',function(data){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    //console.log(data);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    var json = JSON.parse(data);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    console.log(json);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">});</span></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 