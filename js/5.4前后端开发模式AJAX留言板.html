<html>
<head>
  <title>5.4前后端开发模式/AJAX留言板</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303788 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win32);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="564"/>
<h1>5.4前后端开发模式/AJAX留言板</h1>

<div>
<span><div><hr/><br/></div><div>1、混合开发    </div><div><span>    <span>    </span></span>前端代码与后端代码混和在一起          </div><div>2、<b>分离式开发</b>    </div><div><span>    <span>    </span></span>前端代码与后端代码分离开发，通过<b>AJAX</b>方式连接前后端<b>交互</b>。</div><div><br/></div><div><hr/></div><div><span style="line-height: 1.45;">混合开发 :</span><br/></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">============================after.php</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>&lt;?PHP</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>    header('Content-Type:text/html; charset=utf-8');     </b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>    $con = mysqli_connect('localhost','root','','h51706');</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>    mysqli_query($con,'set names utf8');</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>    $sql = &quot;select * from news&quot;;</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>    $query = mysqli_query($con,$sql);</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>    while($row = mysqli_fetch_assoc($query)){</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>        $arr[] = $row;</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>    }</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>?&gt;</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;!doctype html&gt;</span></div><div><font face="Monaco">...</font></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;html&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;body&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;ul id=&quot;list&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   <b> &lt;?PHP</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>        forEach($arr as $item){</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>            //echo $item['title'];</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>            echo '&lt;li&gt;&lt;a href=&quot;'.$item['url'].'&quot;&gt;'.$item['title'].'&lt;/a&gt;&lt;/li&gt;';</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>        }</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><b>    ?&gt;</b></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/ul&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/body&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/html&gt;</span></div></div><div><br/></div><div><hr/>
分离式开发：（AJAX留言板）</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>对AJAX进行封装    </div><div>        getAjax( )    </div><div>        postAjax( )       </div><div>   </div><div>require_once()    </div><div>        提取公共部分代码    </div><div>  </div><div>添加时间     </div><div>        order by * desc         </div><div>     </div><div>提取部分数据    </div><div>        limit      </div><div><br/></div><div>返回添加后的ID     </div><div>        mysqli_insert_id($con)  </div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>==================================messsage.html</div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;body&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;div id=&quot;text&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &lt;div&gt;用户名：&lt;input type=&quot;text&quot;&gt;&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &lt;div&gt;内容：&lt;textarea&gt;&lt;/textarea&gt;&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &lt;div&gt;&lt;button&gt;发表&lt;/button&gt;&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;ul id=&quot;list&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/ul&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;button id=&quot;moreBtn&quot;&gt;加载更多&lt;/button&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;script&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">moment.locale('zh-cn'); //本地化成中文。</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">var list = document.getElementById('list');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">var moreBtn = document.getElementById('moreBtn');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">var text = document.getElementById('text');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">var messUser = text.getElementsByTagName('input')[0];</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">var messContent = text.getElementsByTagName('textarea')[0];</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">var messBtn = text.getElementsByTagName('button')[0];</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">initMessage();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">moreBtnBind();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">addMessageBind();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">function initMessage(){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    getAjax('initMessage.php','',function(data){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        //console.log(data);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        var json = JSON.parse(data);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            if(json.code == '0'){  //成功</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                setData(json);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    });</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">function moreBtnBind(){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    var page = 0;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    moreBtn.onclick = function(){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        page++;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        getAjax('pageMessage.php','page='+page,function(data){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            var json = JSON.parse(data);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            if(json.code == '0'){  //成功</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                setData(json);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            else{  //失败</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                moreBtn.style.display = 'none';</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        });</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    };</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">function addMessageBind(){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    messBtn.onclick = function(){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        var user = messUser.value;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        var content = messContent.value;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        postAjax('addMessage.php','user='+user+'&amp;content='+content,function(data){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            var json = JSON.parse(data);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            if(json.code == '0'){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                var li = document.createElement('li');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                li.className = 'clear';</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                li.innerHTML = `</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;h2&gt;${user}&lt;/h2&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;p&gt;${content}&lt;/p&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                &lt;span&gt;刚刚&lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                `;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                list.insertBefore(li,list.children[0]);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        });</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    };</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">function setData(json){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    for(var i=0;i&lt;json.list.length;i++){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        var li = document.createElement('li');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        /*li.className = 'clear';</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        li.innerHTML = '&lt;h2&gt;'+ json.list[i].username +'&lt;/h2&gt;\</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                        &lt;p&gt;'+ json.list[i].content +'&lt;/p&gt;\</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                        &lt;span&gt;'+ moment(json.list[i].date).fromNow() +'&lt;/span&gt;';*/</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        li.className = 'clear';</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        li.innerHTML = `</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;h2&gt;${json.list[i].username}&lt;/h2&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;p&gt;${json.list[i].content}&lt;/p&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;span&gt;${moment(json.list[i].date).fromNow()}&lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        `;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        list.appendChild(li);                </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">function getAjax(url,data,fn){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    var param = data ? '?'+data : data;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    var xhr = new XMLHttpRequest();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    xhr.onreadystatechange = function(){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        if(xhr.readyState==4 &amp;&amp; xhr.status==200){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            fn(xhr.responseText);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    };</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    xhr.open('GET',url + param,true);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    xhr.send(null);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">function postAjax(url,data,fn){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    var param = data ? data : null;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    var xhr = new XMLHttpRequest();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    xhr.onreadystatechange = function(){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        if(xhr.readyState==4 &amp;&amp; xhr.status==200){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            fn(xhr.responseText);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    };</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    xhr.open('POST',url,true);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    xhr.send(param);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/script&gt;</span></div></div><div><br/></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div>====================================connect.php</div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;?PHP</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span>    //公共文件</span><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    header('Content-Type:text/html; charset=utf-8');     </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    $con = mysqli_connect('localhost','root','','h51706');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    mysqli_query($con,'set names utf8');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">?&gt;</span></div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">// wamp时间设定 timestamp</span></div><div><img src="5.4前后端开发模式AJAX留言板_files/Image.png" type="image/png" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div>================================initMessage.php</div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;?PHP</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    require_once('connect.php');  //引入公共文件</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><span>    </span>/<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">/limit ：截取数组操作，两个参数：起始位置，长度</span></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    $sql = &quot;select * from message order by date desc limit 0 , 3&quot;;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    $query = mysqli_query($con,$sql);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    if($query){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        while($row = mysqli_fetch_assoc($query)){</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            $arr[] = $row;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        //echo json_encode($arr);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        echo '{&quot;code&quot;:&quot;0&quot;,&quot;message&quot;:&quot;请求成功&quot;,&quot;list&quot;:'.json_encode($arr).'}';    </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    else{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        echo '{&quot;code&quot;:&quot;1&quot;,&quot;message&quot;:&quot;请求失败&quot;,&quot;list&quot;:[]}';    </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">?&gt;</span></div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;-en-codeblock:true;"><div><span style="line-height: 1.45;">==================================== </span><br/></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>  <br/></div><div><br/></div></span>
</div></body></html> 